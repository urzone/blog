<!DOCTYPE html>
<html lang="cmn-Hans-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>v2ray - XiaO | 缄默之语</title>
    <meta property="og:title" content="v2ray - XiaO | 缄默之语">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="有时候，简单粗暴实则为一种更有效的问题处理方式。譬如，当我需要查找一些文献的时候，在浏览器里，我得到的是网络服务商如下的反馈：
Web Page Blocked Access to the web page you were trying to visit has been blocked due to phishing, malware, or copyright infringing &amp;hellip;">
      <meta property="og:description" content="有时候，简单粗暴实则为一种更有效的问题处理方式。譬如，当我需要查找一些文献的时候，在浏览器里，我得到的是网络服务商如下的反馈：
Web Page Blocked Access to the web page you were trying to visit has been blocked due to phishing, malware, or copyright infringing &amp;hellip;">
      
    

    
    
    
    <meta name="twitter:image" content="https://blog.urz.one/images/logo.png">
    
    

    

    
    
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    



<link rel="stylesheet" href="/css/custom.css" />


<link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
<link rel="manifest" href="/images/icons/manifest.json">
<link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#cc342c">
<link rel="shortcut icon" href="/images/icons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="XiaO">
<meta name="application-name" content="XiaO">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-TileImage" content="/images/icons/mstile-144x144.png">
<meta name="msapplication-config" content="/images/icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<meta name="google-site-verification" content="3C4lz-WqreDsFFohPRed1rO14aKeEDmTbw2lfIHN6og" />
  </head>

  
  <body class="cn">
    <header class="masthead">
      

<h1><a href="/"><img src="/images/logo.svg" alt="XiaO" /></a></h1>



      <nav class="menu">
  <ul>
  
  
  <li><a href="/">首页</a></li>
  
  <li><a href="/cn/">日志</a></li>
  
  <li><a href="/cn/note/">缄语</a></li>
  
  <li><a href="/en/">En</a></li>
  
  

<li class="menu-extra"></li>


<li><a href="/cn/index.xml" type="application/rss+xml" title="RSS feed">订阅</a></li>

<li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Attribution-NonCommercial-ShareAlike 4.0 International">版权</a></li>


  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>v2ray</h1>


<h3>XiaO / 
2023-05-04</h3>

<hr>


      </header>



<p>有时候，简单粗暴实则为一种更有效的问题处理方式。譬如，当我需要查找一些文献的时候，在浏览器里，我得到的是网络服务商如下的反馈：</p>
<pre tabindex="0"><code>Web Page Blocked

Access to the web page you were trying to visit has been blocked due to phishing, malware, or copyright infringing content. Always exercise caution when clicking on links, especially those found in email messages.

User: xx.xx.xx.xxx

URL: xxx-xxx.xx

Category: copyright-infringement
</code></pre><p>以此，我着实出离地愤怒了。花了钱，买了道，你还要管我去哪里！当然，有人会说了，这终究好过某些根本不告诉你缘由的行为。奈何，收拾行囊，再次跑路。</p>
<h2 id="v2ray-客户端">v2ray 客户端</h2>
<h3 id="v2ray-与-qv2ray">v2ray 与 Qv2ray</h3>
<p>简单说来，<a href="https://github.com/v2ray/v2ray-core">v2ray</a> 是跑路的核心装备，<a href="https://github.com/Qv2ray/Qv2ray">Qv2ray</a> 则为这件装备打上了更易于使用的马甲。</p>
<p>对于新机器，可在终端里执行如下命令，其会自动安装 <code>v2ray</code>与<code>qv2ay</code>：</p>
<pre tabindex="0"><code>brew install qv2ray 
</code></pre><p>对于老爷机，需要注意 v2ray 的版本。譬如，系统 Catalina 下，可选择 <a href="https://raw.githubusercontent.com/Homebrew/homebrew-core/3ca91ac17be25ac1c4d7f720b74b3562dad73197/Formula/v2ray.rb">v4.45.2</a>，下载该文件。</p>
<pre tabindex="0"><code>brew install path/to/v2ray.rb # 即刚下载的文件的路径

brew install qv2ray
</code></pre><h3 id="qv2ray-插件">Qv2ray 插件</h3>
<p>Qv2ray 并不支持 v2ray 以外的代理协议，因此在将其作为其它协议客户端使用前，需要为 Qv2ray 添加相应插件（注意插件版本号和 Qv2ray 版本号对应）：</p>
<ul>
<li><a href="https://github.com/Qv2ray/QvPlugin-SS/releases/">Qv2ray Shadowsocks 插件</a></li>
<li><a href="https://github.com/Qv2ray/QvPlugin-SSR/releases/">Qv2ray SSR 插件</a></li>
<li><a href="https://github.com/Qv2ray/QvPlugin-Trojan/releases">Qv2ray Trojan 插件</a></li>
<li><a href="https://github.com/Qv2ray/QvPlugin-Trojan-Go/releases/">Qv2ray Trojan-go 插件</a></li>
<li><a href="https://github.com/Qv2ray/QvPlugin-NaiveProxy/releases/">Qv2ray NaiveProxy 插件</a></li>
</ul>
<p>将下载的插件放入插件文件夹 <code>~/Library/Preferences/qv2ray/plugins</code>。</p>
<h3 id="配置-qv2ray">配置 Qv2ray</h3>
<p>启动 Qv2ray，在其首选项中检查能否正常启动 v2ray：</p>
<pre tabindex="0"><code>Preferences --&gt; Kernel Settings: 
- [ ] Check System Date and Time from the Internet
- [ ] Check V2Ray Core Settings
</code></pre><p>如果没有报错即安装完成，否则需要检查 v2ray 的版本，安装合适的版本。如此，装备即打造完成。</p>
<h3 id="使用-qv2ray">使用 Qv2ray</h3>
<p>从 Import &ndash;&gt; Share Link，将 <code>vless:// </code>, <code>vmess:// </code>, <code>trojan:// </code> 等开头的地址复制进去，即完成导入。</p>
<h2 id="v2ray-服务器端">v2ray 服务器端</h2>
<p>使用 VPS 服务商提供的用户名合明码，登录相应的虚拟主机管理页面。此时虚拟主机中可能会有预装系统，当然自己也可以重新装系统。</p>
<p>使用 <a href="https://www.jjput.com/archives/macos-for-ssh">SSH 管理工具</a>，连接远端的虚拟主机，譬如，<a href="https://github.com/kingToolbox/WindTerm">WindTerm</a>，<a href="https://termius.com/">termius</a>，<a href="https://www.hostbuf.com/">FinalShell</a> 等。</p>
<h3 id="八合一-一键脚本httpswwwv2ray-agentcom"><a href="https://www.v2ray-agent.com/">八合一 一键脚本</a></h3>
<ol>
<li>在 SSH 管理工具中，连接远端虚拟主机后，下载该脚本安装相应的 v2ray 服务：</li>
</ol>
<pre tabindex="0"><code>wget -P /root -N --no-check-certificate &#34;https://raw.githubusercontent.com/mack-a/v2ray-agent/master/install.sh&#34; &amp;&amp; chmod 700 /root/install.sh &amp;&amp; /root/install.sh
</code></pre><ol start="2">
<li>安装脚本，依次选择如下，</li>
</ol>
<pre tabindex="0"><code>1.安装

1.Xray-core

请输入要配置的域名 例: www.v2ray-agent.com ---&gt; 域名:xxxx.xxx
(此处所使用的域名，如果 DNS 由 CloudFlare 管理，此处仅设置为 DNS ONLY，暂时不要开启 Proxy)

默认端口 443 [回车即可]

默认 TLS 证书 [回车即可]

生成随机路径 [回车即可]

默认不添加 CloudFlare 自选 CNAME [回车即可]

默认随机 UUID [回车即可]

使用 TLS + Vision 端口
</code></pre><ol start="3">
<li>相关服务管理</li>
</ol>
<pre tabindex="0"><code>$ vasma

============================================================== 
1.重新安装 
2.任意组合安装 
3.切换 Trojan[XTLS] 
4.Hysteria 管理 
5.REALITY 管理 
-------------------------工具管理----------------------------- 
6.账号管理 
7.更换伪装站 
8.更新证书 
9.更换 CDN 节点 
10.IPv6 分流 
11.WARP 分流 
12.流媒体工具 
13.添加新端口 
14.BT 下载管理 
15.切换 alpn 
16.域名黑名单 
-------------------------版本管理----------------------------- 
17.core 管理 
18.更新脚本 
19.安装 BBR、DD 脚本 
-------------------------脚本管理----------------------------- 
20.查看日志 
21.卸载脚本 
</code></pre><h2 id="ipv6-虚拟地址httpswwwmoeelfcomarchives301html"><a href="https://www.moeelf.com/archives/301.html">IPv6 虚拟地址</a></h2>
<p>挂上 VPS 后，访问 Google 总是跳人机验证。此意味着该 IPv4 被谷歌标记为了恶意地址。因此，可能需要更换 IP 了。配置并使用 IPv6 来访问 Google，某种意义上来说，也算是更换 IP 了。由于该廉价虚拟主机不提供 IPv6，故而借用虚拟 IPv6 ，使原来仅有 IPv4 的主机拥有 IPv6 地址。</p>
<h3 id="warp-一键脚本httpsgithubcomfscarmenwarp添加-ipv6-虚拟地址"><a href="https://github.com/fscarmen/warp">warp 一键脚本</a>，添加 IPv6 虚拟地址</h3>
<pre tabindex="0"><code>wget -N https://raw.githubusercontent.com/fscarmen/warp/main/menu.sh &amp;&amp; bash menu.sh

warp [option] [lisence]

======================================================================================================================

 1.  为 IPv4 only 添加 WARP IPv4 网络接口 (bash menu.sh 4) 
 2.  为 IPv4 only 添加 WARP IPv6 网络接口 (bash menu.sh 6) 
 3.  为 IPv4 only 添加 WARP 双栈网络接口 (bash menu.sh d) 
 4.  打开 WARP (warp o) 
 5.  安装 CloudFlare Client 并设置为 Proxy 模式 (bash menu.sh c) 
 6.  更换支持 Netflix 的 IP (warp i) 
 7.  永久关闭 WARP 网络接口，并删除 WARP、 Linux Client 和 WireProxy (warp u) 
 8.  刷 WARP+ 流量 (warp p) 
 9.  升级内核、安装BBR、DD脚本 (warp b) 
 10. 同步最新版本 (warp v) 
 11. WARP 解锁 Netflix 等流媒体专业一键(支持多平台、多方式和 TG 通知) 
 12. 安装 iptable + dnsmasq + ipset，让 WARP IPv4 only 接管流媒体流量 (不适用于 IPv6 only VPS) (bash menu.sh e) 
 13. 安装 wireproxy，让 WARP 在本地创建一个 socks5 代理 (bash menu.sh w) 
 14. 安装 CloudFlare Client 并设置为 WARP 模式 (bash menu.sh l) 
 0.  退出脚本 
</code></pre><p>可选择 2，为 IPv4 only 添加 WARP IPv6 网络接口，此时账户类型可选择免费账户，以便更容易分配 IP 地址。</p>
<pre tabindex="0"><code>warp h
 warp h (帮助菜单）
 warp n (获取 WARP IP)
 warp o (临时warp开关)
 warp u (卸载 WARP 网络接口和 Socks5 Client)
 warp b (升级内核、开启BBR及DD)
 warp a (更换账户为 Free，WARP+ 或 Teams)
 warp p (刷WARP+流量)
 warp v (同步脚本至最新版本)
 warp r (WARP Linux Client 开关)
 warp 4/6 (WARP IPv4/IPv6 单栈)
 warp d (WARP 双栈)
 warp c (安装 WARP Linux Client，开启 Socks5 代理模式)
 warp l (安装 WARP Linux Client，开启 WARP 模式)
 warp i (更换支持 Netflix 的IP)
 warp e (安装 Iptables + dnsmasq + ipset 解决方案)
 warp w (安装 WireProxy 解决方案)
 warp y (WireProxy socks5 开关)
 warp s 4/6/d (优先级: IPv4 / IPv6 / VPS default)
</code></pre><ul>
<li>
<p>后续可再选择  <code>warp a</code> 升级账户类型，更容易分配到 IP。</p>
</li>
<li>
<p>验证优先级，执行 <code>curl ip.p3terx.com</code> 命令，显示 IPv4 地址则代表 IPv4 优先，否则为 IPv6 优先。</p>
</li>
</ul>
<p>IPv4 与 IPv6 网络优先级设置，优先级不是一定要设置的，这仅限于 VPS 本身对外发起的网络请求。使用某科学的上网工具不一定有效，建议使用<code>工具内置的路由分流</code>功能，即前面八合一一键脚本中的 <code>10. IPv6</code> 分流。</p>
<h3 id="ipv6-分流">IPv6 分流</h3>
<pre tabindex="0"><code>vasma
10
speedtest,facebook,cn,perplexity,startpage,google,youtube
</code></pre><p>如此，菇菇的人机验证就消失了。</p>
<h3 id="cloudflare-warp-网速测试">Cloudflare WARP 网速测试</h3>
<p>使用 speedtest.net 提供的 CLI 工具测试通过 WARP 访问外部网络的极限网速，不过仅限测试 IPv4 的速度。</p>
<p>安装 Ookla Speedtest CLI</p>
<pre tabindex="0"><code>curl -fsSL git.io/speedtest-cli.sh | sudo bash
</code></pre><p>测速：</p>
<pre tabindex="0"><code>speedtest


   Speedtest by Ookla

     Server: Ziply Fiber - Seattle, WA (id = 35180)
        ISP: Cloudflare
    Latency:     1.69 ms   (0.07 ms jitter)
   Download:   140.95 Mbps (data used: 121.4 MB)                               
     Upload:   191.01 Mbps (data used: 165.9 MB)                               
Packet Loss:     1.4%
</code></pre><h2 id="he-ipv6-tunnel-broker">HE IPv6 Tunnel Broker</h2>
<p><a href="https://tunnelbroker.net/">IPv6 隧道</a></p>
<ul>
<li>
<p><a href="https://tunnelbroker.net/">IPv6 隧道</a> &ndash;&gt; Create Regular Tunnel &ndash;&gt; 输入虚拟机的 IPv4 地址，点击创建隧道 &ndash;&gt; Client IPv6 Address</p>
</li>
<li>
<p>Example Configurations 示例配置，找到匹配自己虚拟机的系统的配置片段，将生成的配置片段与<a href="https://agou-ops.cn/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/#%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BD%BF%E7%94%A8ipv6%E9%9A%A7%E9%81%93">下面脚本</a>中相应的片段替换，并保存为 <code>install_ipv6_tunnel.sh</code>。</p>
</li>
</ul>
<pre tabindex="0"><code>#!/usr/bin/env bash 
set -euo pipefail

#
#**************************************************
# Author:         AGou-ops                        *
# E-mail:         agou-ops@foxmail.com            *
# Date:           2021-12-02                      *
# Description:                                    *
# Copyright 2021 by AGou-ops.All Rights Reserved  *
#**************************************************

# ----------------
echoColor(){
  echo -e &#34;\033[36m$1 \033[0m&#34;
}

# 启用ipv6

cat &lt;&lt; EOF &gt;&gt; /etc/sysctl.conf
net.ipv6.conf.all.disable_ipv6 = 0
net.ipv6.conf.default.disable_ipv6 = 0
net.ipv6.conf.lo.disable_ipv6 = 0
EOF

sysctl -p
echoColor &#34;====== 启用ipv6 ======\n&#34;

# ！！！！！重要！！！！！
# 将下面的重定向内容替换为上面示例的配置片段内容
cat &lt;&lt; EOF &gt;&gt;  /etc/network/interfaces

 auto he-ipv6
  iface he-ipv6 inet6 v4tunnel
   address xxxx:xxx:a:10d::2
   netmask 64
   endpoint 216.xx.xx.xx
   local 23.xx.x.xx
   ttl 255
   gateway 2001:xx:a:10d::1
EOF

echoColor &#34;====== 修改网络配置文件成功 ======\n&#34;

apt update -y 2&gt;&amp;1 &gt; /dev/null
apt install ifupdown dnsutils -y 2&gt;&amp;1 &gt; /dev/null

echoColor &#34;====== 安装必要包完成，图个方便，不为啥 ======\n&#34;

sleep 1
# 启动ipv6网络接口，如果没生效可以尝试重启网络
ifup he-ipv6
echoColor &#34;====== 接口内容信息如下 ======\n&#34;
ip a show dev he-ipv6

echoColor &#34;========================\n&#34;
# 备份原来的dns
cp -a /etc/resolv.conf{,.bak}

cat &lt;&lt; EOF &gt;&gt; /etc/resolv.conf
nameserver 8.8.8.8
nameserver 8.8.4.4
EOF

echoColor &#34;====== 修改dns完成 ======\n&#34;

# 这里用ping查看ipv6地址也可以，这里我图方便使用dig好了
google_ipv6=$(dig www.google.com AAAA | grep -E &#34;^www&#34; | awk &#39;{print $5}&#39;)

echo &#34;$google_ipv6 www.google.com&#34; &gt; /etc/hosts

echoColor &#34;====== 修改hosts文件完成 ======\n&#34;

# 默认访问时会使用IPv6线路进行访问，考虑到速度问题，建议优先使用IPv4
sed -i &#39;s@#precedence ::ffff:0:0/96  100@precedence ::ffff:0:0/96  100@g&#39; /etc/gai.conf

echoColor &#34;====== 配置优先IPv4完成 ======\n&#34;

echoColor &#34;\n\nDone.&#34;
</code></pre><p>使用 root 用户运行以上脚本：</p>
<pre tabindex="0"><code>chmod +x install_ipv6_tunnel.sh
./install_ipv6_tunnel.sh
</code></pre><pre tabindex="0"><code># 查询本机外网 IPv6 地址
curl 6.ipw.cn

# 测试网络是 IPv4 还是 IPv6 访问优先 (访问 IPv4/IPv6 双栈站点，如果返回IPv6地址，则IPv6访问优先)
curl test.ipw.cn
</code></pre>

  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/cn/2023-04-30/fate-and-coincidence/">三张红玫瑰</a></span>
  <span class="nav-next"><a href="/cn/2023-05-07/continuous-crystallizer/">连续结晶仪</a> &rarr;</span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/cn\/2023-04-30\/fate-and-coincidence\/';
    
  } else if (e.which == 39) {  
    
    url = '\/cn\/2023-05-07\/continuous-crystallizer\/';
    
  }
  if (url) window.location = url;
});
</script>






<script async src="/js/fix-toc.js"></script>


<script async src="/js/center-img.js"></script>


<script async src="/js/right-quote.js"></script>


<script async src="/js/fix-footnote.js"></script>


<script async src="/js/math-code.js"></script>


<script async src="/js/external-link.js"></script>


<script async src="/js/alt-title.js"></script>


<script async src="/js/header-link.js"></script>




<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>



<script async src="https://www.googletagmanager.com/gtag/js?id=G-54MWHPVDFP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-54MWHPVDFP');
</script>
  
  
  <hr>
  <div class="copyright">© <a href="/">XiaO</a> 2006 - 2023</div>
  
  </footer>
  </article>
  
  </body>
</html>

